# Angel-subgraph

This repository contains subgraph for Angel Protocol. 
https://thegraph.com/hosted-service/subgraph/angelprotocolfinance/angel-giving

The Graph is a decentralized protocol for indexing and querying data from EVM blockchains. It makes it possible to query data that is difficult to query directly.

## Quick start

The first thing you need to do is clone this repo and installing the dependencies with npm. Your system's node version should be `v18` or higher.
```shell
> git clone https://github.com/AngelProtocolFinance/ap-subgraph && cd ap-subgraph
> npm install
```

## Update the config files
There are files for both Mumbai and Polgyon mainnet included in the `./config` folder. Each file has the contract addresses and starting block to begin indexing at. This file must be checked and updated before deploying to SubGraph.

## Build the main `subgraph.yaml` file from the template and network config file
We use a config file paired with Handlebars templates to allow us to quickly build the required `subgraph.yaml` file for deploying the subgraph to different networks.

```shell
> npm run prepare:{ polygon || mumbai }
```

## Manually Install and start from scratch
### Installation
```
npm install -g @graphprotocol/graph-cli
```

Initialize the Graph
```
graph init \
  --product hosted-service
  --from-contract <CONTRACT_ADDRESS> \
  --network goerli \
  --index-events \
```
    
### Unit Testing Framework
Matchstick is a unit testing framework that enables subgraph developers to test their mapping logic in a sandboxed environment and deploy their subgraphs with confidence!
```
npm install --dev matchstick-as
```
    
Postgres installation command (Linux)
```
sudo apt install postgresql
```
    
## Run Options
#### Generate Typescript Code
```
graph codegen
```
This command is used to generate TypeScript code from the subgraph manifest and the GraphQL schema.

#### Compile subgraph
```
graph build
```
This command is used to compile the TypeScript code generated by "graph codegen" and create a deployment-ready subgraph

#### Test subgraph
```
graph test 
```
OR 
```
graph test [datasource] --version [version]
```
Matchstick version : ```0.5.4```

#### Test Coverage
```
graph test -c
```
#### Test coverage screenshots
```
tests/Test coverage
```

## Deployment
#### Authenticate through CLI 
```
graph auth --product hosted-service [Access Token] 
```
#### Deploy subgraph
```
graph deploy --product hosted-service [subgraphID/projectName]
```

## Directory Information

- abi: Contains all the abi files for the protocol contracts
- generated: Contains the TypeScript code that is automatically generated by the Graph protocol's CLI tool when a subgraph is deployed or updated.
- src: Contains the custom TypeScript code that defines the mappings between the smart contracts and the subgraph's schema. 
- test: Contains all the tests for the subgraph
- schema.graphql : Schema for all the contracts
- subgraph.yaml : Contains the mapping logic for the subgraph
